echo "üé• Checking for new/updated videos to compress..."

# Check if there are any MP4 files in the videos directory
if [ -d "public/videos" ]; then
  # Check if there are any .mp4 files staged for commit
  if git diff --cached --name-only | grep -q "public/videos/.*\.mp4$"; then
    echo "üìπ Found MP4 files staged for commit"
    echo "üé¨ Running video compression..."
    npm run compress:videos

    # Add compressed videos back to staging area
    git add public/videos/*.mp4

    echo "‚úÖ Video compression completed and files staged"
  else
    echo "‚è≠Ô∏è  No MP4 files found in staged changes"
  fi
else
  echo "‚è≠Ô∏è  No videos directory found"
fi

echo ""
echo "üñºÔ∏è  Checking for new/updated images to compress..."

# Check if there are any image files in the images directory
if [ -d "public/images" ]; then
  # Check if there are any image files staged for commit
  if git diff --cached --name-only | grep -qE "public/images/.*\.(png|jpg|jpeg|webp)$"; then
    echo "üì∏ Found image files staged for commit"
    echo "üñºÔ∏è  Running image compression..."
    npm run compress:images

    # Add compressed images and registry back to staging area
    git add public/images/*.png public/images/*.jpg public/images/*.jpeg public/images/*.webp 2>/dev/null || true
    git add public/images/.compressed-images.json 2>/dev/null || true

    echo "‚úÖ Image compression completed and files staged"
  else
    echo "‚è≠Ô∏è  No image files found in staged changes"
  fi
else
  echo "‚è≠Ô∏è  No images directory found"
fi